import java.util.ArrayList;
import java.util.HashMap;
import org.json.simple.JSONArray;
import org.json.simple.JSONObject;

public class ProgrammableCommand extends CommandBehavior {
	
	private static final String PROGRAMMABLE_KEY = "Programmable";

	@Override
	public String createCommand(int controllerID, int machineID, int orderID, String drink, HashMap<String, Integer> options, ArrayList<String> recipe) {
		
		JSONModule optionsModule = new JSONModule();
		
		JSONModule itemModule;
		for (String s : options.keySet()){
			
			itemModule = new JSONModule();
			itemModule.put(NAME_KEY, s);
			itemModule.put(QUANTITY_KEY, options.get(s));
			optionsModule.add(itemModule.toString());
		}
		
		JSONModule recipeModule = new JSONModule();
		
		for (String s : recipe){
			
			itemModule = new JSONModule();
			itemModule.put(COMMAND_STEP_KEY, ADD_KEY);
			itemModule.put(OBJECT_KEY, s);
			recipeModule.add(itemModule);
		}
		
		JSONModule innerModule = new JSONModule();
		innerModule.put(CONTROLLER_ID_KEY, controllerID);
		innerModule.put(COFFEE_MACHINE_ID_KEY, machineID);
		innerModule.put(ORDER_ID_KEY, orderID);
		innerModule.put(DRINK_NAME_KEY, drink);
		innerModule.put(REQUEST_TYPE_KEY, PROGRAMMABLE_KEY);
		innerModule.put(OPTIONS_KEY, optionsModule);
		innerModule.put(RECIPE_KEY, recipeModule);
		
		JSONModule outerModule = new JSONModule();
		outerModule.put(COMMAND_KEY, innerModule.toString());
		
		return outerModule.toString();
		
		
		JSONObject jobject = new JSONObject();
		
		JSONObject jcommand = new JSONObject();
		jcommand.put("controller_id", controllerID);
		jcommand.put("coffee_machine_id", machineID);
		jcommand.put("orderID", orderID);
		jcommand.put("DrinkName", drink);
		jcommand.put("Requesttype", "Programmable");
		
		JSONArray joptions = new JSONArray();
		
		for (String s : options.keySet()){
			
			JSONObject item = new JSONObject();
			item.put("name", s);
			item.put("qty", options.get(s));
			joptions.add(item);
		}
		
		JSONArray jrecipe = new JSONArray();
		
		for (String s : recipe){
			
			JSONObject item = new JSONObject();
			item.put("commandstep", "add");
			item.put("object", s);
			jrecipe.add(item);
		}
		
		jcommand.put("Options:", joptions);
		jcommand.put("Recipe", jrecipe);
		
		jobject.put("command", jcommand);
		
		return jobject.toJSONString();
	}
}
